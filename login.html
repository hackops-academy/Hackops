<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>HackOps Login (Static)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    body{background:#000;color:#0ff;font-family:monospace;display:flex;align-items:center;justify-content:center;height:100vh}
    .box{background:rgba(0,0,0,.75);border:1px solid #0ff;padding:22px;border-radius:10px;width:420px;text-align:center}
    input{width:100%;padding:10px;margin-top:12px;background:#000;border:1px solid #0ff;color:#0ff;border-radius:8px}
    button{margin-top:12px;padding:10px 14px;border-radius:8px;background:#0ff;color:#000;border:none;font-weight:bold}
    #msg{color:#ff6b6b;margin-top:10px;white-space:pre-wrap}
  </style>
</head>
<body>
  <div class="box">
    <h2>HackOps â€” Login</h2>
    <input id="email" type="email" placeholder="Your email (user@example.com)" />
    <input id="password" type="password" placeholder="Your password / key" />
    <button id="login">Unlock</button>
    <div id="msg"></div>
  </div>

<script>
const USERS_FILE = 'users.json'; // file in your repo
const SALT = 'CHANGE_THIS_SALT_TO_A_SECRET'; // MUST match generator's salt

function show(msg){ document.getElementById('msg').innerText = msg; }

async function loadUsers(){
  const res = await fetch(USERS_FILE, {cache:'no-store'});
  if(!res.ok) throw new Error('Failed to load users.json: ' + res.status);
  return res.json();
}

document.getElementById('login').addEventListener('click', async ()=>{
  show('');
  const email = document.getElementById('email').value.trim().toLowerCase();
  const pwd = document.getElementById('password').value;

  if(!email || !pwd){ show('Enter email and password'); return; }

  try {
    const users = await loadUsers();
    const entry = users.find(u => u.email === email);
    if(!entry){ show('No account for this email'); return; }

    // compute hash with same salt
    const computedHash = CryptoJS.SHA256(SALT + pwd).toString();

    if (computedHash !== entry.pwd_hash) {
      show('Incorrect password');
      return;
    }

    // decrypt content using user's password
    try {
      const plain = CryptoJS.AES.decrypt(entry.content, pwd).toString(CryptoJS.enc.Utf8);
      if(!plain) throw new Error('empty_decrypt');
      // Store decrypted content in localStorage and redirect to index.html
      localStorage.setItem('hackops_decrypted_content', plain);
      localStorage.setItem('hackops_email', email);
      window.location.href = 'index.html';
    } catch (e) {
      show('Failed to decrypt content (wrong key?)');
    }
  } catch (err) {
    console.error(err);
    show('Could not load user data (check users.json path)');
  }
});
</script>
</body>
</html>
